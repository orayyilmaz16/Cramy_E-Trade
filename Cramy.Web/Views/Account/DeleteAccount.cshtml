@{
    ViewData["Title"] = "Hesabı Sil";
}

<section class="container py-5 delete-page">
    <div class="row justify-content-center">
        <div class="col-12 col-md-10 col-lg-8 col-xl-7">

            <!-- Hero / Warning -->
            <div class="page-hero hero-glass rounded-4 p-4 mb-4 position-relative overflow-hidden">
                <div class="hero-orb orb-1"></div>
                <div class="hero-orb orb-2"></div>

                <div class="position-relative d-flex align-items-center gap-3">
                    <div class="hero-icon danger">
                        <i class="bi bi-exclamation-triangle"></i>
                    </div>
                    <div>
                        <h1 class="h4 fw-semibold mb-1">Hesabı Silme</h1>
                        <p class="text-muted mb-0">
                            Bu işlem geri alınamaz. Hesabınız ve ilişkili verileriniz kalıcı olarak silinebilir.
                        </p>
                    </div>
                </div>
            </div>

            @if (TempData["DeleteError"] != null)
            {
                <div class="alert alert-danger d-flex align-items-center gap-2">
                    <i class="bi bi-x-circle"></i>
                    <span>@TempData["DeleteError"]</span>
                </div>
            }

            @if (TempData["DeleteSuccess"] != null)
            {
                <div class="alert alert-success d-flex align-items-center gap-2">
                    <i class="bi bi-check-circle"></i>
                    <span>@TempData["DeleteSuccess"]</span>
                </div>
            }

            <div class="hero-glass rounded-4 p-4 p-lg-5">
                <!-- Risk summary -->
                <div class="risk-card rounded-4 p-3 p-md-4 mb-4">
                    <div class="d-flex align-items-start gap-3">
                        <div class="risk-icon">
                            <i class="bi bi-shield-lock"></i>
                        </div>
                        <div>
                            <h2 class="h6 fw-semibold mb-2">Silme işleminden sonra</h2>
                            <ul class="clean-list mb-0 text-muted">
                                <li>Hesabınıza tekrar giriş yapamazsınız.</li>
                                <li>Sipariş geçmişiniz ve profil bilgileriniz sistemden kaldırılabilir.</li>
                                <li>Yasal zorunluluklara bağlı kayıtlar saklama süreleri boyunca tutulabilir.</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Confirm steps -->
                <div class="steps mb-4">
                    <div class="step-item">
                        <div class="step-dot">1</div>
                        <div>
                            <div class="fw-semibold">Kararı doğrulayın</div>
                            <div class="text-muted small">Aşağıdaki iki onayı işaretleyin.</div>
                        </div>
                    </div>
                    <div class="step-item">
                        <div class="step-dot">2</div>
                        <div>
                            <div class="fw-semibold">Silme işlemini tamamlayın</div>
                            <div class="text-muted small">Buton aktif olduğunda işlemi onaylayın.</div>
                        </div>
                    </div>
                </div>

                <form asp-action="DeleteAccountConfirmed" method="post" class="needs-validation" novalidate>
                    @Html.AntiForgeryToken()

                    <div class="mb-3">
                        <div class="form-check confirm-check">
                            <input class="form-check-input" type="checkbox" id="confirm1" required>
                            <label class="form-check-label" for="confirm1">
                                Bu işlemin geri alınamaz olduğunu anlıyorum.
                            </label>
                            <div class="invalid-feedback">Devam etmek için onay gerekli.</div>
                        </div>
                    </div>

                    <div class="mb-4">
                        <div class="form-check confirm-check">
                            <input class="form-check-input" type="checkbox" id="confirm2" required>
                            <label class="form-check-label" for="confirm2">
                                Hesabımın silinmesiyle erişimimi kaybedeceğimi kabul ediyorum.
                            </label>
                            <div class="invalid-feedback">Devam etmek için onay gerekli.</div>
                        </div>
                    </div>

                    <div class="d-flex flex-wrap gap-2 justify-content-between align-items-center">
                        <a asp-action="Profile" class="btn btn-outline-primary btn-lg px-4">
                            <i class="bi bi-arrow-left me-2"></i> Vazgeç
                        </a>

                        <button type="submit" class="btn btn-danger btn-lg px-4" id="deleteBtn" disabled>
                            <i class="bi bi-trash3 me-2"></i> Hesabımı Kalıcı Olarak Sil
                        </button>
                    </div>

                    <div class="mt-4 small text-muted">
                        <div class="d-flex align-items-start gap-2">
                            <i class="bi bi-info-circle mt-1"></i>
                            <div>
                                Eğer yalnızca e-posta bildirimlerini kapatmak istiyorsanız, silmek yerine profil ayarlarını güncellemeyi değerlendirin.
                            </div>
                        </div>
                    </div>
                </form>
            </div>

            <p class="text-center text-muted small mt-4 mb-0">
                © @DateTime.Now.Year — Cramy
            </p>
        </div>
    </div>
</section>

@section Styles {
    <style>
        .delete-page {
            animation: fadeUp .55s ease both;
        }
       

        .hero-glass {
            background: rgba(255,255,255,0.62);
            border: 1px solid rgba(255,255,255,0.45);
            backdrop-filter: blur(14px);
            -webkit-backdrop-filter: blur(14px);
            box-shadow: 0 16px 44px rgba(0,0,0,0.10);
        }

        .page-hero {
            position: relative;
        }

        .hero-icon {
            width: 64px;
            height: 64px;
            border-radius: 20px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #0d6efd, #6610f2);
            box-shadow: 0 14px 30px rgba(13,110,253,0.35);
            color: #fff;
            font-size: 1.8rem;
            flex-shrink: 0;
        }

            .hero-icon.danger {
                background: linear-gradient(135deg, #dc3545, #b02a37);
                box-shadow: 0 14px 30px rgba(220,53,69,0.25);
            }

        /* Decorative orbs */
        .hero-orb {
            position: absolute;
            width: 520px;
            height: 520px;
            border-radius: 50%;
            filter: blur(28px);
            opacity: .55;
            pointer-events: none;
        }

        .orb-1 {
            left: -260px;
            top: -260px;
            background: radial-gradient(circle at 30% 30%, rgba(220,53,69,0.40), transparent 60%);
        }

        .orb-2 {
            right: -280px;
            bottom: -280px;
            background: radial-gradient(circle at 30% 30%, rgba(13,110,253,0.35), transparent 60%);
        }

        /* Risk */
        .risk-card {
            background: rgba(220,53,69,0.06);
            border: 1px solid rgba(220,53,69,0.16);
        }

        .risk-icon {
            width: 44px;
            height: 44px;
            border-radius: 16px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: rgba(220,53,69,0.10);
            color: #dc3545;
            font-size: 1.15rem;
            flex: 0 0 auto;
        }

        .clean-list {
            padding-left: 1.2rem;
            margin-bottom: 0;
        }

            .clean-list li {
                margin: .35rem 0;
            }

        /* Steps */
        .steps {
            display: grid;
            gap: .8rem;
        }

        .step-item {
            display: flex;
            align-items: center;
            gap: .75rem;
            padding: .75rem .85rem;
            border-radius: 16px;
            background: rgba(13,110,253,0.05);
            border: 1px solid rgba(13,110,253,0.12);
        }

        .step-dot {
            width: 34px;
            height: 34px;
            border-radius: 14px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            background: rgba(13,110,253,0.12);
            color: rgba(13,110,253,0.95);
            flex: 0 0 auto;
        }

        /* Confirm checks */
        .confirm-check {
            padding: .85rem .95rem;
            border-radius: 16px;
            background: rgba(255,255,255,0.55);
            border: 1px solid rgba(0,0,0,0.06);
        }

        .form-control:focus, .btn:focus, .form-check-input:focus {
            box-shadow: 0 0 0 .1rem #fff, 0 0 0 .25rem rgba(220,53,69,.20);
        }
    </style>
}

@section Scripts {
    <script>
        // Bootstrap-style validation
        (function () {
            const forms = document.querySelectorAll('.needs-validation');
            Array.from(forms).forEach(form => {
                form.addEventListener('submit', function (event) {
                    if (!form.checkValidity()) {
                        event.preventDefault();
                        event.stopPropagation();
                    }
                    form.classList.add('was-validated');
                }, false);
            });
        })();

        // Enable delete button only if both confirmations are checked
        (function () {
            const c1 = document.getElementById('confirm1');
            const c2 = document.getElementById('confirm2');
            const btn = document.getElementById('deleteBtn');
            if (!c1 || !c2 || !btn) return;

            function sync() {
                btn.disabled = !(c1.checked && c2.checked);
            }

            c1.addEventListener('change', sync);
            c2.addEventListener('change', sync);
            sync();
        })();
    </script>
}
